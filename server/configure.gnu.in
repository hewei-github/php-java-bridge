#!/bin/sh

# create configure from the autotools and invoke
rm -rf autom4te.cache
aclocal
autoheader
autoconf

# On the Mac libtool is called "glibtool"
{ { libtool=glibtool;$libtool --version 2>/dev/null| fgrep "(GNU libtool)"; }||
{ libtool=libtool;$libtool --version| fgrep "(GNU libtool)"; } } &&
{ "${libtool}ize" -f 2>/dev/null || libtoolize -f; ln -sf `which "${libtool}"` libtool; }

automake -a --foreign 

ext="@EXTENSION_DIR@"
pld="@phplibdir@"
sh ./configure "$@" --with-extdir="$ext" --libdir="$pld" --datadir="$pld" --bindir="$pld" || (
echo "Back-end configuration failed."
echo "Please install the recommended autoconf, libtool and automake versions"
echo "or disable back-end configuration and use the pre-compiled J2EE back-end:"
echo 
echo "    ./configure --disable-backend --with-java=<JAVA_HOME>"
echo
exit 1
)

